---
import type { CollectionEntry } from 'astro:content'
import FormattedDate from '@/components/FormattedDate.astro'
import type { HTMLTag, Polymorphic } from 'astro/types'

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
  post: CollectionEntry<'post'>
  withDesc?: boolean
}

const { as: Tag = 'div', post, withDesc = false } = Astro.props
---

<a
  class="group block space-y-3"
  data-astro-prefetch
  href={`/posts/${post.id}/`}
>
  <div class="flex items-center gap-4 text-sm text-muted-foreground">
    <div class="flex items-center gap-2">
      <svg
        class="h-4 w-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <rect
          height="18"
          rx="2"
          ry="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          width="18"
          x="3"
          y="4"></rect>
        <line
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          x1="16"
          x2="16"
          y1="2"
          y2="6"></line>
        <line
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          x1="8"
          x2="8"
          y1="2"
          y2="6"></line>
        <line
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          x1="3"
          x2="21"
          y1="10"
          y2="10"></line>
      </svg>
      <FormattedDate date={post.data.publishDate} />
    </div>
    {
      post.data.draft && (
        <span class="rounded-full border border-link/50 bg-link/10 px-2 py-0.5 text-xs font-medium text-link">
          Draft
        </span>
      )
    }
  </div>
  <Tag class="space-y-2">
    <h3
      class="text-2xl font-bold text-accent-2 transition-colors group-hover:text-accent"
    >
      {post.data.title}
    </h3>
  </Tag>
  {
    withDesc && (
      <p class="line-clamp-3 text-muted-foreground">{post.data.description}</p>
    )
  }
  <div
    class="flex items-center gap-2 text-sm font-medium text-link opacity-0 transition-all group-hover:opacity-100"
  >
    Read more
    <svg
      class="h-4 w-4 transition-transform group-hover:translate-x-1"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        d="M13 7l5 5m0 0l-5 5m5-5H6"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"></path>
    </svg>
  </div>
</a>
