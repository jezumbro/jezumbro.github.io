---
import Search from '@/components/Search.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import { menuLinks } from '@/site.config'
---

<header
  class="group relative mb-16 flex items-center border-b border-border/40 pb-6 backdrop-blur-sm"
  id="main-header"
>
  <div class="flex w-full items-center justify-between sm:flex-row">
    <a
      aria-current={Astro.url.pathname === '/' ? 'page' : false}
      class="group inline-flex items-center gap-2 transition-all duration-300 hover:opacity-80"
      href="/"
    >
      <div
        class="flex h-10 w-10 items-center justify-center rounded-lg bg-accent transition-all duration-500 sm:h-12 sm:w-12"
      >
        <svg
          class="h-6 w-6 text-white sm:h-7 sm:w-7"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M13 10V3L4 14h7v7l9-11h-7z"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"></path>
        </svg>
      </div>
      <span class="text-xl font-bold text-accent-2 sm:text-2xl">A Blog</span>
    </a>
    <div class="flex items-center gap-6">
      <nav
        aria-label="Main menu"
        class="absolute left-0 right-0 top-20 hidden flex-col gap-4 rounded-xl border border-border bg-bgColor/95 p-6 shadow-2xl backdrop-blur-xl group-[.menu-open]:flex sm:static sm:flex sm:flex-row sm:gap-1 sm:rounded-none sm:border-0 sm:bg-transparent sm:p-0 sm:shadow-none"
        id="navigation-menu"
      >
        {
          menuLinks.map((link) => (
            <a
              aria-current={Astro.url.pathname === link.path ? 'page' : false}
              class="group relative rounded-lg px-4 py-2 font-medium transition-all hover:bg-muted aria-[current=page]:text-accent sm:hover:text-link"
              data-astro-prefetch
              href={link.path}
            >
              <span class="relative z-10">{link.title}</span>
              {Astro.url.pathname === link.path && (
                <span class="absolute inset-x-0 -bottom-0.5 hidden h-0.5 rounded-full bg-accent sm:block" />
              )}
            </a>
          ))
        }
      </nav>
      <Search />
      <ThemeToggle />
      <mobile-button>
        <button
          aria-expanded="false"
          aria-haspopup="menu"
          aria-label="Open main menu"
          class="group relative flex h-9 w-9 items-center justify-center rounded-lg border border-border transition-all hover:bg-muted sm:hidden"
          id="toggle-navigation-menu"
          type="button"
        >
          <svg
            aria-hidden="true"
            class="h-5 w-5 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
            fill="none"
            focusable="false"
            id="line-svg"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M3.75 9h16.5m-16.5 6.75h16.5"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
          <svg
            aria-hidden="true"
            class="absolute h-5 w-5 scale-0 text-link opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
            fill="none"
            focusable="false"
            id="cross-svg"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6 18L18 6M6 6l12 12"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </button>
      </mobile-button>
    </div>
  </div>
</header>

<script>
  import { toggleClass } from '@/utils/domElement'

  class MobileNavBtn extends HTMLElement {
    #menuOpen: boolean = false

    connectedCallback() {
      const headerEl = document.getElementById('main-header')!
      const mobileButtonEl = this.querySelector<HTMLButtonElement>('button')

      mobileButtonEl?.addEventListener('click', () => {
        if (headerEl) toggleClass(headerEl, 'menu-open')
        this.#menuOpen = !this.#menuOpen
        mobileButtonEl.setAttribute('aria-expanded', this.#menuOpen.toString())
      })
    }
  }

  customElements.define('mobile-button', MobileNavBtn)
</script>
